// db.js - MySQLæ•°æ®åº“è¿æ¥
const mysql = require('mysql2');

// åˆ›å»ºè¿æ¥æ± 
const pool = mysql.createPool({
  host: 'localhost',
  port: 3306,
  user: 'root',
  password: '123456',  // ä½ å®‰è£…MySQLæ—¶è®¾ç½®çš„å¯†ç 
  database: 'lantern_game',
  waitForConnections: true,
  connectionLimit: 10,
  queueLimit: 0
});

// å¯¼å‡ºPromiseç‰ˆæœ¬
const db = pool.promise();

// æµ‹è¯•è¿æ¥
async function testConnection() {
  try {
    const [rows] = await db.query('SELECT 1 + 1 AS result');
    console.log('âœ… MySQLæ•°æ®åº“è¿æ¥æµ‹è¯•æˆåŠŸ:', rows[0].result === 2 ? 'è®¡ç®—æ­£ç¡®' : 'è®¡ç®—é”™è¯¯');
    return true;
  } catch (error) {
    console.error('âŒ MySQLè¿æ¥å¤±è´¥:', error.message);
    console.log('\nğŸ’¡ è¯·æ£€æŸ¥ï¼š');
    console.log('1. MySQLæœåŠ¡æ˜¯å¦å¯åŠ¨ï¼Ÿ(è¿è¡Œ: net start MySQL80)');
    console.log('2. é»˜è®¤è´¦å·å¯†ç ï¼šroot / root123');
    console.log('3. å¦‚æœæ²¡æœ‰lantern_gameæ•°æ®åº“ï¼Œæˆ‘ä»¬ä¼šè‡ªåŠ¨åˆ›å»º');
    return false;
  }
}

// è‡ªåŠ¨æµ‹è¯•è¿æ¥
testConnection();

module.exports = db;